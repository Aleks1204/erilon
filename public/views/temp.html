

$http.get('/personageSpellsByPersonageId/' + personageId).success(function (results) {
var deletePromises = [];

angular.forEach(results.personageSpells, function (personageSpell) {
deletePromises.push($http.delete('/personageSpells/' + personageSpell.id));
});

$q.all(deletePromises).then(function () {
var addPromises = [];
angular.forEach($scope.personageSpells, function (personageSpell) {
addPromises.push($http.post('/personageSpells', {
trigger_skill_id: personageSpell.Spell.id,
personage_id: personageId,
currentLevel: personageSpell.currentLevel,
talented: personageSpell.talented,
tutored: personageSpell.tutored
}));
});
$q.all(addPromises).then(function () {
personageSpellAllPromise.resolve();
});
});
});